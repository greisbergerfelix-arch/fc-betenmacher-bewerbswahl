<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>FC-Betenmacher – Abstimmungsstatus Mitglieder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background:#f4f6f8;
      margin:0;
      padding:20px;
    }
    .container {
      max-width:1100px;
      margin:0 auto;
    }
    .card {
      background:#fff;
      padding:20px;
      border-radius:12px;
      box-shadow:0 4px 10px rgba(0,0,0,0.08);
      margin-bottom:20px;
    }
    h1 {
      text-align:center;
      margin-top:0;
    }
    table {
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    th, td {
      padding:6px 8px;
      border-bottom:1px solid #e5e7eb;
      text-align:left;
      white-space:nowrap;
    }
    th {
      background:#f3f4f6;
      font-weight:600;
    }
    tr:nth-child(even) td {
      background:#f9fafb;
    }
    .muted {
      color:#6b7280;
      font-size:13px;
    }
  </style>
</head>
<body>

<div class="container">

  <div class="card">
    <h1>Abstimmungsstatus Mitglieder</h1>
    <p class="muted">
      Interne Übersicht. Diese Seite sollte nicht öffentlich geteilt werden.
    </p>
    <p>
      <strong>Gesamt-Mitglieder laut Liste:</strong> <span id="totalMembers">–</span><br>
      <strong>Mitglieder mit abgegebener Stimme:</strong> <span id="memberVoted">–</span><br>
      <strong>Mitglieder ohne Stimme:</strong> <span id="memberNotVoted">–</span>
    </p>
  </div>

  <div class="card">
    <h2>Bereits abgestimmt</h2>
    <p class="muted">
      Mitglieder, die bereits eine Stimme abgegeben haben.
    </p>
    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Nachname</th>
            <th>Vorname</th>
            <th>Zeit der Stimmabgabe</th>
          </tr>
        </thead>
        <tbody id="tableVoted">
          <tr><td colspan="4" class="muted">Daten werden geladen …</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h2>Noch nicht abgestimmt</h2>
    <p class="muted">
      Mitglieder aus der Liste ohne abgegebene Stimme.
    </p>
    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Nachname</th>
            <th>Vorname</th>
          </tr>
        </thead>
        <tbody id="tableNotVoted">
          <tr><td colspan="3" class="muted">Daten werden geladen …</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
// Firebase-Konfiguration
const firebaseConfig = {
  apiKey: "AIzaSyCRkIU7F42QPrs2oMOymQxF4MVKM7oQZTw",
  authDomain: "fc-betenmacher-bewerbswa-b44e4.firebaseapp.com",
  databaseURL: "https://fc-betenmacher-bewerbswa-b44e4-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "fc-betenmacher-bewerbswa-b44e4",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Mitgliederliste
const members = [
  { nr: 1, last: "Anglberger", first: "Lukas", birth: "05.08.2001"},
  { nr: 2, last: "Auswöger", first: "Alexander", birth: "07.10.1982"},
  { nr: 3, last: "Auswöger", first: "Mario", birth: "25.07.1981"},
  { nr: 4, last: "Bormann", first: "Heiko", birth: "12.02.1977"},
  { nr: 5, last: "Brandstätter", first: "Fabian", birth: "16.04.1998"},
  { nr: 6, last: "Eisl", first: "Karl", birth: "24.05.1961"},
  { nr: 7, last: "Enzesberger", first: "Alois", birth: "21.12.1991"},
  { nr: 8, last: "Enzesberger", first: "Gerhard sen.", birth: "26.08.1961"},
  { nr: 9, last: "Enzesberger", first: "Gerhard jun.", birth: "14.02.1987"},
  { nr:10, last: "Eppenschwandtner", first: "Franz", birth:"28.05.1961"},
  { nr:11, last: "Eppenschwandtner", first: "Georg", birth:"23.02.1979"},
  { nr:12, last: "Eppenschwandtner", first: "Stefan", birth:"14.09.1986"},
  { nr:13, last: "Feistritzer", first: "Philipp", birth:"20.01.1982"},
  { nr:14, last: "Greinz-Einberger", first:"Andreas", birth:"20.06.1988"},
  { nr:15, last: "Greinz-Einberger", first:"Ferdinand", birth:"08.08.1961"},
  { nr:16, last: "Greinz-Einberger", first:"Lukas", birth:"20.09.2001"},
  { nr:17, last: "Greisberger", first:"Andreas", birth:"21.06.1996"},
  { nr:18, last: "Greisberger", first:"Felix (Freez)", birth:"04.05.1987"},
  { nr:19, last: "Greisberger", first:"Franz", birth:"28.11.1960"},
  { nr:20, last: "Greisberger", first:"Georg", birth:"18.04.1983"},
  { nr:21, last: "Greisberger", first:"Jakob", birth:"14.08.2002"},
  { nr:22, last: "Greisberger", first:"Thomas", birth:"03.01.1984"},
  { nr:23, last: "Greisberger", first:"Toni", birth:"19.12.1960"},
  { nr:24, last: "Gruber", first:"Bernhard", birth:"06.09.1993"},
  { nr:25, last: "Gruber", first:"Matthias", birth:"21.12.1960"},
  { nr:26, last: "Grubinger", first:"Gerhard", birth:"11.06.1973"},
  { nr:27, last: "Grubinger", first:"John", birth:"02.10.1971"},
  { nr:28, last: "Lemberger", first:"Norbert", birth:"23.07.1994"},
  { nr:29, last: "Lichtmannsperger", first:"Martin", birth:"20.02.1971"},
  { nr:30, last: "Meindl", first:"Martin", birth:"01.02.1978"},
  { nr:31, last: "Niederbrucker", first:"Hans", birth:"04.06.1944"},
  { nr:32, last: "Niederbrucker", first:"Hans-Jürgen", birth:"02.02.1975"},
  { nr:33, last: "Oberascher", first:"Ferdinand", birth:"29.11.1960"},
  { nr:34, last: "Oberascher", first:"Patrick", birth:"05.07.1995"},
  { nr:35, last: "Oberascher", first:"Sebastian", birth:"21.02.1967"},
  { nr:36, last: "Pichler", first:"David", birth:"20.07.1985"},
  { nr:37, last: "Reiter", first:"Roland", birth:"12.01.1978"},
  { nr:38, last: "Schmidhuber", first:"Andreas", birth:"03.06.1988"},
  { nr:39, last: "Schmidhuber", first:"Florian", birth:"25.04.1990"},
  { nr:40, last: "Schmidhuber", first:"Simon", birth:"15.12.2000"},
  { nr:41, last: "Schoosleitner", first:"Christian", birth:"22.02.1987"},
  { nr:42, last:"Schoosleitner", first:"Michael", birth:"14.02.1983"},
  { nr:43, last:"Schoosleitner", first:"Josef", birth:"20.03.1960"},
  { nr:44, last:"Stöllinger", first:"Hans", birth:"14.04.1960"},
  { nr:45, last:"Strumegger", first:"Benedikt", birth:"28.08.1988"},
  { nr:46, last:"Strumegger", first:"Bernhard", birth:"09.08.1970"},
  { nr:47, last:"Strumegger", first:"Felix (Fedda)", birth:"04.11.1998"},
  { nr:48, last:"Strumegger", first:"Florian", birth:"16.06.1976"},
  { nr:49, last:"Strumegger", first:"Josef", birth:"27.01.1958"},
  { nr:50, last:"Strumegger", first:"Sebastian", birth:"15.04.1991"},
  { nr:51, last:"Wesenauer", first:"Karl", birth:"09.05.1961"},
  { nr:52, last:"Willroider", first:"Herbert", birth:"08.05.1960"},
  { nr:53, last:"Winkler", first:"Robert", birth:"09.05.1995"},
  { nr:54, last:"Zoister", first:"Andreas", birth:"26.03.1990"},
  { nr:55, last:"Schmidhuber", first:"Natanael", birth:"25.01.2007"}
];

// Hilfsfunktion birth->key
function birthToKey(birth) {
  const p = birth.split('.');
  return `${p[2]}-${p[1]}-${p[0]}`;
}

// Daten laden
function loadStatus() {
  const tMembers = document.getElementById('totalMembers');
  const tVoted = document.getElementById('memberVoted');
  const tNot = document.getElementById('memberNotVoted');
  const tableVoted = document.getElementById('tableVoted');
  const tableNotVoted = document.getElementById('tableNotVoted');

  tMembers.textContent = members.length.toString();

  db.ref('votes').on('value', snap => {
    const votes = snap.val() || {};

    const voted = [];
    const not = [];

    members.forEach(m => {
      const key = birthToKey(m.birth);
      if (votes[key]) voted.push({...m, vote: votes[key]});
      else not.push(m);
    });

    tVoted.textContent = voted.length;
    tNot.textContent = not.length;

    // Tabelle: abgestimmt
    tableVoted.innerHTML = '';
    if (voted.length === 0) {
      tableVoted.innerHTML = '<tr><td colspan="4" class="muted">Noch keine Stimme vorhanden.</td></tr>';
    } else {
      voted.sort((a,b)=>a.nr-b.nr).forEach(m=>{
        let ts = '–';
        if (m.vote.ts) {
          const d = new Date(m.vote.ts);
          ts = d.toLocaleString('de-AT',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit'});
        }
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${m.nr}</td>
          <td>${m.last}</td>
          <td>${m.first}</td>
          <td>${ts}</td>
        `;
        tableVoted.appendChild(tr);
      });
    }

    // Tabelle: nicht abgestimmt
    tableNotVoted.innerHTML='';
    if (not.length === 0) {
      tableNotVoted.innerHTML='<tr><td colspan="3" class="muted">Alle haben abgestimmt.</td></tr>';
    } else {
      not.sort((a,b)=>a.nr-b.nr).forEach(m=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td>${m.nr}</td>
          <td>${m.last}</td>
          <td>${m.first}</td>
        `;
        tableNotVoted.appendChild(tr);
      });
    }
  });
}

loadStatus();
</script>

</body>
</html>
